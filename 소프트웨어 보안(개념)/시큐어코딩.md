### 시큐어 코딩이란?
- 설계 및 구현 단계에서 해킹 등의 공격을 유발할 가능성이 있는 잠재적인 보안 취약점을 사전에 제거하고, 외부 공격으로 부터 안전한 소프트웨어를 개발하는 기법
- 소프트웨어 보안 약점을 방지하기 위한 시큐어 코딩 가이드에 따른 개발 수행이 필요하다.

### 보안 약점 VS 보안 취약점
- 보안 취약점 : 해킹 등 외부 공격으로 시스템의 보안정책을 침해하는 보안사고의 실제 원인이 되는 시스템 상의 보안 허점
- 보안 약점 : 보안 취약점의 근본 원인이 될 SW의 결합이나 실수, 버그 등의 오류를 의미한다.

### 시큐어 코딩의 7대 원칙
1. 입력 데이터 검증 및 표현
- 프로그램 입력값에 대한 검증 누락, 부적절한 검증, 잘못된 형식 지정
- 사용자. 프로그램 입력 데이터에 대한 유효성 검증체계를 수립하고, 실패 시 처리 설계 및 구현
2. 보안 기능
- 보안 기능(인증, 접근제어, 기밀성, 암호화, 권한 관리 등)의 적절치 못한 구현
- 인증,접근 통제, 권한 관리, 비밀번호 등의 정책이 적절하게 반영되도록 설계 및 구현한다.
3. 시간 및 상태
- 거의 동시에 수행 지원하는 병령 시스템 또는 하나 이상의 프로세스가 동작하는 환경에서 시간 및 상태의 부적절한 관리
- 공유 자원의 접근 직렬화, 병렬 실행 가능 프레임워크 사용, 블록문 내에서만 재기함수를 호출한다.
4. 애러 처리
- 애러 미처리,  불충분한 처리 등으로 에러 메시지에 중요 정보가 포함
- 애러 또는 오류 사항을 처리하지 않거나, 불충분하게 처리되어 중요 정보 유출 등의 보안 약점이 발생하지 않도록 시스템 설계 단계서 구현해야 한다.
5. 코드 오류
- 개발자가 범할 수 있는 코딩 오류로 인해 유발.
- 코딩 규칙 도출 후 검증 가능한 스크립트 구성과 경고 순위의 최상향 조정 후 경고 메시지 코드 제거
6. 캡슐화
- 기능성이 불충분한 캡슐화로 인해 인가 되지 않은 사용자에게 데이터 누출
- 디버그 코드 제거와 필수 정보 외의 클래스 내 프라이빗 접근자 지정
7. API 오용
- 의도된 사용에 반하는 방버으로 API를 사용하거나, 보안에 취약한 API의 사용
- 개발 언어 별 취약 API 확보 및 취약 API 검출 프로그램 사용


#### 직렬화란?
- 데이터 구조나 오브젝트 상태를 다른 컴퓨터 환경으로 저장하고 재구성할 수 있는 포맷으로 변환하는 과정.


## 한번 새부적으로 들여다보자.

### 입력 데이터 검증 및 표현
- 입력 데이터로 인해 발생되는 문제들을 예방하기 위해 구현 단계에서 검증해야 할 보안 점검 항목
- 입력 데이터로 인해 발생되는 문제를 예방하려면, 소프트 웨어 갭라 및 구현 단계에서 유효성 검증 체계를 갖추고, 검증되지 않은 데이터의 입력을 처리하도록 구현해야 한다.

#### 대표적인 취약점
1.  XSS(Cross site script)
- 검증되지 않은 외부 입력 데이터가 포함된 웹페이지가 전송되는 경우, 사용자가 해당 웹페이지를 열람함으로써 웹페이지에 포함된 부적절한 스크립트가 실행되는 공격.
- 특수문자 등록을 방지하기 위해 특수문자 필터링, HTML 태그 사용 금지, < 문자 사용시 &it로 변환처리, 자바 스크립트로 시작하는 문자열은 모두 문자열 반환 처리
2. 사이트 간 요청 위조(CSRF : Cross-Site-Request-Forgery)
- 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정 웹 사이트에 요청하게 하는 공격
- 입력화면 폼을 작성시, GET 방식보다 POST방식을 이용함.
- 입력 폼과 입력처리 프로그램에서 세션별 CSRF 토큰을 사용하여 점검
- 중요 기능의 경우 재인증을 통해 안전하게 실제 요청 여부를 확인하도록 구현.
3. SQL 삽입(injection)
- 응용 프로그램의 보안 취약점을 이용해 악의적인 SQL 구문을 삽입, 실행시켜서 데이터베이스의 접근을 통해 정보를 탈취하거나 조작 등의 행위를 하는 공격법
- 바인딩 매개변수 방식을 적용하여 사전에 변수 타입을 명시적으로 구현
- 사용자로부터 입력될 수 있는 모든 값을 체크하여 사전에 필터링
- Servlet Fiter 기능 적용(JAVA에서만 적용가능)


##### XSS(cross site script)의 공격 유형
- Stored XSS : 방문자들이 악성 스크립트가 포함된 페이지를 읽어 봄과 동시에 악성 스크립트가 브라우저에서 실행되면 감염되는 기법
- Reflected XSS : 공격용 악성 URL을 생성한  후, 이메일로 사용자에게 전송하면 사용자가 URL을 클릭하는 즉시 공격 스크립트가 피해자로 반사되어 접속 사이트에 민감정보를 공격자에게 전송하게 되는 기법
- DOM(Document Object Model) XSS : 공격자는 DOM 기반 XSS 취약점이 있는 브라우저를 대상으로 조작된 URL을 이메일을 통해 발송하고 피해자가 URL 클릭 시 공격 피해를 당하는 기법


### XSS 공격의 방식
![img1 daumcdn](https://user-images.githubusercontent.com/72552897/164573969-653bc80d-7b32-4094-9c87-e325dab4a4c0.png)
1. 임의의 XSS 취약점이 존재하는 서버에 XSS 코드를 작성하여 삽입 저장
2. 해당 웹 서비스 사용자가 공격자가 작성해놓은 XSS 코드에 접근
3. 사용자가 XSS 코드가 저장된 페이지에 정보를 요청
4. 사용자의 시스템에서 XSS 코드 실행
5. XSS 코드가 실행된 결과가 공격자에게 전달되고 공격자는 결과를 가지고 웹 서버에서 2차 해킹 시도.


### SQL 삽입 공격 유형
1. From SQL injection
-  HTML Form 기반 인증을 담당하는 애플리케이션의 취약점이 있는 경우, 사용자 인증을 위한 쿼리 문의 조건을 임의로 조작하여 인증을 우회하는 기법
2. Union SQL injection
- 쿼리의 UNION 연산자를 이용하여 한 쿼리의 결과를 다른 쿼리의 결과에 결함하여 공격하는 기법
3. Stored Procedure SQL injection
- 저장 프로시저를 이용하여 공격하는 기법
4. Mass SQL injection
- 기존 SQL injection의 확장된 개념으로 한 번의 공격으로 대량의 DB 값이 변조되어 홈페이지에 치명적인 영향을 미치는 공격법
5. Error- Based SQL injection
- DB 쿼리에 대한 에러값을 기반으로 한 단계씩 점진적으로 DB 정보를 획득할 수 있는 공격법
6. Blind SQL injection
- DB 쿼리에 대한 오류 메시지를 반환하지 않으면 공격을 할 수 없는  Error- Based와 다릴, 오류 메시지가 아닌 쿼리 결과의 참과 거짓을 통해 의도되지 않은 SQL 문을 실행함으로써 데이터베이스를 비정상적으로 공격하는 기법

### SQL 삽입 공격의 방식
![pasted image 0](https://user-images.githubusercontent.com/72552897/164576051-ca5bacf1-26ab-4050-8962-4f843ad4b8d6.png)
1. 웅용 프로그램의 취약점 탐지
2. 악의적인 SQL 구문 삽입하여 인증 우회
3. 권한이 상승되어 DB의 정보 탈취 및 조작 실행

### CSRF(Cross site Request Forgery)의 방식
![1006a345-9ef1-40a8-8013-554cd20f0b51](https://user-images.githubusercontent.com/72552897/164576142-a65bc5a5-7ae7-47dd-841d-5407aef9b3db.png)
1. 공격자는 CSRF 스크립트가 포함된 게시물을 등록
2. 사용자는 CSRF 스크립트가 포함된 페이지의 게시물 열람 요청
3. 게시물을 읽은 사용자의 권한으로 공격자가 원하는 요청 발생
4. 공격자가 원하는 CSRF 스크립트 결과가 발생

### 보안 기능 개념
- 소프트웨어 개발 단계에서 인증, 접근제어, 기밀성, 암호화, 권한 관리 등을 적절하게 구현하기 위한 보안 점검 항목
- 각 보안 기능들은 서비스 환경이나 취급 데이터에 맞게 처리될 수 있도록 구현해야 한다.
### 보안 기능의 취약점
1. 적절한 인증 없이 중요 기능 허용
- 보안 검사를 우회하여 인증과정 없이 중요 정보 또는 기능에 접근 및 변경이 가능
- 중요 정보나 기능을 수행하는 페이지에서는 재인증 기능을 통해 방지
2. 부적절한 인가
- 접근제어 기능이 없는 실행경로를 통해 정보 또는 권한 탈취
- 모든 실행 경로에 대해 접근제어 검사를 수행하고, 사용자에게는 반드시 필욯나 접근권한 만 부여하여 방지
3. 취약한 암호화 알고리즘 사용
- 암호화된 환경설정 파일을 해동하여 비밀번호 등의 중요 정보 탈취
- 안전한 암호화 알고리즘, 안정성이 인증된 암호 모듈을 이용하여 방지
4. 중요 정보 평문 저장 및 전송
- 암호화되지 않은 평문 데이터를 탈취하여 중요 정보 획득 가능
- 중요한 정보 저장 및 전송 시 반드시 암호화 과정을 거치도록 하며, HTTPS, SSL/TLS를 활용하여 방지
5. 하드 코드된 비밀번호
- 프로그램 코드 내부에 패스워드 포함 시 관리자 정보가 노출될 수 있는 보안취약점
- 패스워드는 암호화하여 별도 파일에 저장
- 소프트웨어 설치 시 직접 패스워드나 키를 입력하도록 설계해야 함
6. 취약한 패스워드 요구 조건
- 취약한 사용자 패스워드 조합 규칙에 따른 사용자 계정 보안의 취약점
- 패스워드 생성 시 강한 조건을 지정해야 한다.

### 애러처리의 개념
- 프로그램 실행 시 발생하는 에러를 예외처리하지 못하거나, 에러 정보에 중요한 정보(프로그램 정보, 상세한 에러 내역 등)가 포함될 때 발생할 수 있는 취약점을 예방하기 위한 보안요소.
- 각 프로그래밍 언어의 예외 처리 구문을 통해 오류에 대한 사항을 정의하지 않으면 중요 정보를 노출시키거나 소프트웨어의 실행이 중단되는 등 예기치 못한 문제를 야기한다.

### 애러처리의 취약점
1. 오류 메시지를 통한 정보 노출
- 프로그램이 실행 환경, 사용자, 관련 데이터에 대한 민감한 정보를 포함하는 오류 메시지를 생성하여 공격자의 악성 행위를 도와주는 보안 취약점
- 애러 메시지는 정해진 사용자에게 유용한 최소한의 정보만 표현되어야 한다.
- 예외 사항을 내부적으로 처리하고 사용자에게 민감한 정보를 포함하는 오류 출력 금지
2. 오류 사항 대응 부재
- 오류가 발생할 수 있는 부분을 확인하였으나, 이러한 오류에 대해 에외 처리를 하지 않았거나, 미비로 인해 발생하는 약점
- 오류가 발생할 수 있는 부분에 예외 처리 구문을 작성하고 , 제어문을 활용하여 악용하지 않도록 코딩 
3. 적절하지 않은 예외 처리
- 프로그램 수행 중에 함수의 결괏값에 대한 적절한 처리 또는 예외 사항에  대한 조건을 적절하게 검사하지 않을 경우, 예기치 않은 문제를 일으킬 수 있는 약점
- 값을 반환하는 모든 함수의 결괏값을 검사하여, 그 값이 기대한 값인지 검사하고, 예외 처리를 사용하는 경우에는 광범위한 에외처리 대신 구체적인 에외 처리를 통해 방지


### 새션 통제란?
- 다른 세션 간 데이터 공유 등 세션과 관련되어 발생할 수 있는 취약점을 예방하는 보안 점검 항목
- 이미 연결이 종료된 클라이언트의 정보가 사용 가능한 상태로 방치되는 경우, 허가되지 않은 사용자가 시스템에 접근할 수 있는 보안 약점이 있다.
- 안전한 세션 통제 정책이 적용되기 위해 세션 정보를 안전하게 관리해야 한다.

### 세션 통제 취약점
1. 불충분한 세션 관리
- 인증 시 일정한 규칙이 존재하는 세션 ID를 발급하거나, 세션 타암아웃을 길게 설정한 겨웅, 공격자에 의해 사용자 권한이 도용됨
- 클래스 변수는 세션 간에 공유되는 데이터가 되므로 클래스 설계시 세션 정보를 읽고 쓰기가 가능한 변수를 사용하지 않도록 설계함.

### 코드 오류란?
- 소프트웨어 구현 단계에서 프로그램 변환 시 오류, 서버의 리소스 자원 의 부적절한 반환 등 개발자가 흔하게 실수 하는 프로그램 오류를 예방하기 위한 보안 항목.

### 코드 오류의 취약점
1. 널 포인터 역참조
-  '일반적으로 그 객체가 Null이 될 수 없다'라고 하는 가정을 위반했을 때 발생
-  대부분 운영체제에서 널 포인터는 메모리의 첫 주소를 가리키며, 해당 주소를 참조 할 경우, 소프트웨어가 비정상적으로 종료
-  공격자가 의도적으로 Null 포인터 역참조를 실행하는 경우, 그 결과 발생하는 예외 사항을 추후에 공격자가 악용할 수 있음
-  Null이 될 수 있는 레퍼런스는 참조하기 전에 Null 값인지를 검사하여 안전한 경우에만 사용한다.
2. 정수를 문자로 반환
- 정수를 문자로 반환하면서 표현할 수 없는 범위의 값이 잘려나가 문자에 대한 저장 값이 올바르지 않은 보안 취약점
- 정수를 문자로 변환할 경우, 변환 값의 크기가 변환 값이 저장되는 변수의 크기보다 크지 않도록 함
3. 부적절한 자원 해제
- 힙 메모리, 소켓 등 프로그램 자원 사용 후, 프로그램 오류로 인해 종료된 자원을 반환하지 못했을 때, 발생할 수 있는 보안 취약점
- 자원을 획득하여 사용한 다음에는 finally 블록에서 반드시 자원이 반환되도록 코딩함으로써 방지
4. 초기화되지 않은 변수 사용
- 초기화되지 않은 변수 사용은 변수 선언 후 값이 부여되지 않은 변수를 사용할 때 발생할 수 있는 보안 취약점
- 변수가 선언되어 메모리가 할당되면 해당 메모리에 이전에 사용하던 내용이 계속 남아 있어, 변수가 외부에 노출되는 경우 중요 정보가 악용 될 수 있음
- 변수 선언 시 핳당된 메모리를 초기화함으로써 방지.

#### 널 포인터(Null Pointer)
- 널은 값이 없음을 의미하며, 포인터는 메모리의 위치를 가리키는 요소로서 널 포인터는 포인터에 값이 널이 저장되어 어떠한 것도 가르키지 못하는 상태다.

### 캡슐화 개념
- 외부에 은닉이 필요한 중요한 데이터와 필요한 가능성을 불충분하게 캡슐화했을 때, 인가되지 않은 사용자에게 데이터 유출, 권한 문제 등이 발생할 수 있는 보안 취약점 예방을 위한 항목

#### 캡슐화의 취약점
1. 잘못된 세션에 의한 데이터 정보 노출 
- 다중 스레드 환경에서 싱글톤 객체 필드에서 경쟁 조건으로 인해 동기화 오류가 발생하거나, 맴버 변수의 정보가 노출되는 보안 취약점
- 싱글톤 패턴을 사용하는 경우, 변수 범위에 주의하고,맴버 변수보다 지역 변수를 활용하여 변수의 범위를 제한함으로써 방지한다.
2. 제거되지 않고 남은 디버그 코드
- 디버깅 목적으로 삽입된 코드가 제거되지 않음으로 인해 공격자가 의도하지 않은 정보와 제어 정보가 누출될 수 있는 보안 취약점
- 디버거 코드는 반드시 개발 완료 후 모두 제거해야 한다.
3. 민감한 데이터를 가진 내부 클래스 사용
- 권한이 없는 클래스를 사용하고자 할 떄 발생하는 취약점
- 내부 클래스 사용 시 외부 클래스의 접근 금지 
4. 시스템 데이터 정보 노출
- 시스템, 관리자 DB 정보 등 시스템의 내부 데이터를 시스템 메시지 등을 통해 외부로 출력하도록 코딩했을 때 발생하는 보안 취약점
- 시스템 메시지를 통해 노출되는 메시지는 최소한의 정보만 제공함으로써 방지된다.

### API 오용의 개념
- 서비스에서 제공되는 이용에 반하는 방법으로 API를 이용하거나 보안에 취약한 API를 오용하여 발생할 수 있는 보안 취약점 예방을 위한 보안 검증 항목이다.

### API 오용의 취약점
1. DNS Lookup에 의존한 보안 결정
- 도메인명에 의존하여 인증이나 접근 통제 등의 보안 결정을 내리는 경우, 발생하는 보안 약점
- DNS 엔트리를 속여 동일한 도메인 서버인 것처럼 위장하거나, 사용자와 서버 간의 네트워크 트래픽을 유도하여 악성 사이트를 경유하도록 조작할 수 있음.
- 보안 결정에서 도메인명을 이용한 DNS Lookup을 하지 않도록 함
- DNS 이름 검색 함수를 사용한 후 조건문에서 인증 여부를 수행하는 것보다 IP 주소를 이용하는 것이 DNS 이름을 직접 사용하는 것보다 안전함.
2. 위험하다고 알려진 함수 사용
- 보안 취약점을 고려하지 않고 개발되어, 사용 자체가 취약한 함수들의 보안 취약점.
- Strcpy는 글자 수에 상관 없이, Strncpy는 글자 길이를 지정하는데, 후자가 안전함.
3. 널 매개변수 미검사
- 자바 표준에서 특정 메서드 사용 시 매개변수가 널인 경우, 지정된 값을 반환하지 못해 발생하는 예기치 못한 동작에 대한 보안 취약점
- 널 여부를 점검하는 과정을 거친 후 사용해야 함.


### 유닉스/리눅스 주요 로그 파일
- 유닉스/리눅스 로그가 저장되는 경로는 시스템마다 조금씩 다르다.
- 일반적으로 유닉스의 경우 ./var/adm 디렉토리에 주로 저장되며, 리눅스의  경우 ./var/log 디렉토리에 주로 저장.
- 리눅스에서는 ./var/log 디렉토리에서 시스템의 모든 로그를 기록 및 관리하고 있다.
- 시스템의 /etc/syslog.conf 파일에서 시스템 로그 파일들의 위치를 저장하고 있다.
- 다양한 로그를 바탕으로 해커를 추적하는 것이 가능하다.

### 유닉스/리눅스의 주요 로그 파일
1. wtmp/wtmpx
- 사용자 로그인/로그아웃 정보
- 시스템 shutdown/reboot 정보
- last 명령어로 내용 확인한다.
2. utmp/utmpx
- 현재 시스템에 로그인한 사용자 정보
- who, w, users, finger 명령어
3. btmp/btmpx
- 로그인에 실패한 정보
- lastb 명령어
4. lastlog 명령어
- 사용자 별 최근 로그인 시간 및 접근한 소스 호스트에 대한 정보
- lastlog 명령어.
5. sulog
- su(Switch user) 명령어 실행 성공/실패 결과에 대한 정보
- 택스트 파일이라서 별도의 명령어 없음
6. acct/pacct
- 사용자별로 실행되는 모든 명령어에 대한 로그
- lagtcomm, acctcom 명령어.
7. xferlog
- FTP 서비스 데이터 전송 로그
8. messages
- 부트 메시지 등 시스템의 가장 기본적인 시스템 로그 파일로 운영에 대한 전반적인 메시지를 저장함.
9. secure
- 보안과 관련된 주요 로그를 기록, 사용자 인증과 관련된 로그를 기록.






