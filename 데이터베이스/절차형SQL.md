### 절차형 SQL 개념
= 일반적인 개발 언어처럼 SQL 언어에서도 절차 지향적 프로그램이 가능하도록 하는 트랜잭션 언어
- 절차형 SQL의 종류는 다음과 같다.
1. 프로시저(Procedure) : 일련의 퀴리 들을 마치 하나의 함수처럼 실행하기 위한 퀴리의 집합
2. 사용자 정의 함수(User Defined Function) : 일련의 SQL처리를 수행하고 수행 결과를 단일값으로 반환하는 절차형 SQL
3  트리거(Trigger) : 데이터베이스 시스템에서 삽입, 갱신, 삭제 등의 이벤트가 발생할 때마다 관련 작업이 자동으로 수행되는 SQL
- 출력부
1. DBMS_OUTPUT 패키지 개념
- 메시지를 버퍼에 저장하고 버퍼로부터 메시지를 읽어오기 위한 인터페이스 패키지
- 절차형 SQL이 정상적으로 동작하는 지를 테스트하는 목적으로 활용되는 것이며, 대표적으로 다음과 같다.
- DBMS_OUTPUT.PUT(문자열) : 개행 없이 문자열을 출력하는 프로시저, 
- DBMS_OUTPUT.PUT_LINE(문자열) : 문자열을 출력 후 개행하는 프로시져

### 조건문 IF문
- 프로그래밍에 사용하는 참인지, 거짓인지 사용하는 그 IF와 동일함
<pre>
<code>
IF 조건 THEN 문장;
ELSIF 조건 THEN  문장;
ELSE 문장;
END IF;
</code>
</pre>

### 간단한 케이스 문(SIMPLE CASE Expression)
간단한 케이스 문은 명확한 값을 가지는 조건에 따라 여러 개의 선택 중 하나를 취하고자 할 때 사용하는 조건문
범위 같은 더 복잡한 매칭을 수행하려면 겁색된 CASE 문을 사용해야 한다.

<pre>
<code>
CASE 변수 
WHEN 값1 THEN SET 명령어;
WHEN 값1 THEN SET 명령어;
WHEN 값1 THEN SET 명령어;
WHEN 값1 THEN SET 명령어;
ELSE SET  명령어;
END CASE;
</code>
</pre>

### 검색된 케이스문(Searched Case Expression)
- 검색된 케이스 문은 명확한 값 및 범위를 가지는 조건에 따라 여러 개의 선택 경로 중 하나를 취하고자 할 때 사용하는 조건문

<pre>
<code>
CASE 
WHEN 값1 THEN SET 명령어;
WHEN 값1 THEN SET 명령어;
WHEN 값1 THEN SET 명령어;
WHEN 값1 THEN SET 명령어;
ELSE SET  명령어;
END CASE;
</code>
</pre>

### 반복문
- LOOP 문은 특정 조건이 만족될 때까지 반복해서 문자를 실행하는 것.
<pre>
<code>
LOOP 문장;
EXT WHEN 탈출 조건;
END LOOP;
</code>
</pre>

- WHILE 문
시작과 종료 조건을 지정하여, 참인 동안에는 해당 문장을 반복해서 실행하는 명령어
조건이 참인 경우 반복하고, 조건이 거짓이거나 EXIT WHEN 조건이 만족하는 경우, 반복문을 빠져나온다.

<pre>
<code>
WHILE 반복조건 LOOP 문장;
EXT WHEN 탈출 조건;
END LOOP;
</code>
</pre>

- FOR LOOP 문
시작 값과 끝값을 지정하여 해당 값이 그 구간 내에 있을 때 반복하는 반복문.

<pre>
<code>
FOR 인덱스 IN 시작값 .. 종료값
LOOP 문장;
END LOOP;
</code>
</pre>

### 예외부
예외부는 실행 중 발생가능한 예외 사항을 수행하는 부분이다.
<pre>
<code>
EXCEPTION WHEN 조건 THEN SET 명령어;
</code>
</pre>

### 프로시저의 개념
일련의 퀴리들을 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합

#### 프로시저의 구성
- 선언부(DECLARE) : 프로시저의 명칭, 변수와 인수 그리고 그에 대한 데이터 타입을 정의하는 부분
- 시작/종료부(BEGIN/END) : 프로시저의 시작과 종료를 표현하며 둘다 있어야 함. 다수 실행을 제어하는 기본적 단위가 되며, 논리적 프로세스를 구성함
- 제어부(CONTROL) : 기본적으로 순차적으로 처리되며, 조건문과 반복문을 이용하며 문장처리
- SQL : DML을 주로 사용하며 자주 사용되지 않지만  DLL 중 TRUNCATE 사용
- 예외부 : 시작 종료부에서 실행되는 SQL문이 실행 될때 예외 발생 시 처리 방법을 정의하는 부
- 실행부 : 프로시저에서 수행된  DML 수행 내역의 DBMS 적용 또는 취소 여부를 결정하는 처리부

<pre>
<code>
 CREATE [OR REPLACE] PROCEDURE 프로시저_명
 (파라미터 명 [IN||OUT||INOUT] 데이터 타입, ...)
 IS
 변수 선언
 BEGIN
 명령어;
 [COMMIT||ROLLBACK]
 END;
 </code>
 </pre>
 
 ### 문법 설명
 
 1. [OR REPLACE] : 해당 명령은 기존 프로시저 존재 시에 현재 컴파일하는 내용으로 덮어씀(만약에 해당 명령이 없고, 같은 이름의 프로시저가 존재한다면 애러 발생)
 모드([IN||OUT||INOUT]) : 변수의 입출력을 구분함
 - IN : 운영체제에서 프로시저로 값을 전달하는 모드
 - OUT : 프로시저에서 처리된 결과를 운영체제로 전달하는 모드
 - INOUT : 두가지 기능을 동시에 수행하는 코드
 
2. BEGIN : 프로시저의 시작을 알려주는 키워드
3. COMMIT : 하나의 트랜잭션이 성공적으로 끝나고, 데이터베이스가 일관성 있는 상태에 있을 때, 하나의 트랜잭션이 끝났을 떄 사용하는 연산
4. ROLLBACK : 하나의 트랜잭션이 비정상적으로 종료되어 트랜잭션 원자성이 깨질 경우 처음부터 다시 시작하거나, 부분적으로 연산을 취소함
5. END :  프로시저의 끝을 알려주는 키워드

 ### 프로시저 호출문 작성
 - SQL TOOL을 활용하여 직접 실행 시키는 경우에는 EXECUTE 또는 EXEC 명령얼르 이용하여 프로시저를 실행한다.
 - 프로시저에 입출력 변수가 존재하는 경우 변술르 입력하여 실행
 - 데이터 유형의 경우 자동 변환이 되어 별도 오류가 발생하지 않는 경우가 많지만 가급적 프로시저에서 선언한 데이터 타입과 동일하게 입출력 변수를 넣어서 실행하는 것이 좋다.

### 사용자 정의 함수
1. 사용자 정의 함수는 일련의 SQL 처리를 수행하고 수행 결과를 단일 값으로 반환할 수 있는 절차형 SQL
2. 기본적인 사항은 프로시저와 동일하고 반환에서의 부분만 프로시저와 다르다.
3. 사용자 정의 함수의 호출을 통해 실행되며, 반환되는 단일 값을 조회 또는 삽입, 수정 작업에 이용하는 것이 일반적
4. 기본적인 개념 칭 사용법, 문법 등은 프로시저와 동일하며, 종료 시 단일 값을 반환한다는 것이 가장 큰 차이다.

#### 사용자 정의 함수 구성
-선언부(DECLARE) : 사용자 정의 함수의 명칭, 변수와 인수 그리고 그에 대한 데이터 타입을 정의하는 부분
- 시작부/종료부(BEGIN/END) 
1. 사용자 정의 함수의 시작과 종료를 표현하는 데 필수적이며, BEGIN/END가 쌍으로 이루어 추가됨
2. 다수 실행을 저어하는 기본적 단위가 되며 논리적 프로세스를 구성
- 제어부(CONTROL) : 
1. 기본적으로 순차적으로 처리
2. 비교 조건에 따라 블록 또는 문장을 실행 
3. 조건에 따라 반복 실행
- SQL
1. 조회 용어로 SELECT 문을 사용0
2. 데이터를 조작하는 INSERT, DELETE, UPDATE는 사용할 수 없음
- 예외부(EXCEPTION)
1. BEGIN~END 절에서 실행되는 SQL 문이 실행될 떄 예외 발생 시 예외 처리 방법을 정의하는 처리부
- 반환부(RETURN)
1. 호출문에 대한 함숫값을 반환

### 사용자 정의 함수 문법

<pre>
<code>
CREATE [OR REPLACE] FUNCTION 함수명
(파라미터_명 IN 데이터_타입, ...)
RETURN 데이터_타입
IS
  변수선언
BEGIN
  명령어;
  RETURN 변수;
 END;
 </code>
 </pre>
 
 ### 사용자 정의 함수 구성
 -[OR REPLACE] : 기존 사용자 정의 함수 존재시에 현재 컴파일하는 내용으로 덮어씀
 -모드 (IN) : 변수의 입출력을 구분하며 운영체제에서 사용자 정의 함수로 값을 전달함
- RETURN 데이터 타입 : 사용자 정의 함수가 종료되면 반환되는 데이터 타입
 - BEGIN: 사용자 정의 함수의 시작을 알려주는 키워드
 - RETURN 데이터 값 : 사용자 정의 함수가 종료될 때 반환하는 단일 값을 정의
 - END : 사용자 정의 함수의 끝을 알려줌


### 트리거(Trigger)
- 데이터베이스 시스템에서 삽입, 갱신, 삭제 등의 이벤트가 발생할 때마다 관련 작업이 자동으로 수행되는 절차형 SQL

#### 트리거의 설명
- 특정 테이블에 대한 데이터 변경을 시작점으로 설정하고, 그와 관련된 작업을 자동적으로 수행하기 위해 사용
- 일반적으로 이벤트와 관련된 테이블의 데이터 삽입, 추가, 삭제 작업을 DBMS가 자동적으롯 실행시키는데 활용한다.
- 데이터 무결성 유지 및 로그 메시지 출력 등의 별도 처리를 위해 사용함
- 대표적으로 데이터 변화가 생길 때마다 실행 되는 행 트리거와, 단 한번 실행되는 문장 트리거가 있다.

#### 트리거의 구성
-프로시저나 사용자 정의 함수와 기본 문법은 동일
- 변환 값이 없다는 점, DML을 주된 목적으로 한다는 점에서는 프로시저와 동일함 
- EVENT 명령어를 통해 트리거 실행을 위한 이벤트를 인지한다는 점, 외부 변수의 IN/OUT이 없다는 점이 다른 둘과 다름
- 선언부(DECLARE) : 트리거의 명칭을 정의하는 부분
- 이벤트부(EVENT) : 트리거가 실행되는 타이밍, 이벤트를 명시하는 부분
- 시작 종료부(BEGIN/END) 
1. 트리거의 시작과 종료를 표현하는데 필수적이며, 쌍을 이루며 추가되므로 블록으로 구성
2. 다수 실행을 제어하는 기본적 단위이며, 논리적 프로세스를 구성함
- 제어부(CONTROL) : 기본적으론 순차적으로 처리되며 비교 조건에 따라 블록 또는 문장을 실행한다. 그리고 반복 실행.
- SQL : DML을 주로 사용하고, 자주 사용되지 않지만 DDL(TRUNCATE 등)을 사용함
- 예외부(EXCEPTION) :  SQL  문이 실행 될 떄 예외 발생시 예외 처리 방법을 정의함

### 트리거 문법
<pre>
<code>
CREATE [OR REPLACE] TRIGGER 트리거명
[BEFORE || AFTER] 유형 ON 테이블명
[FOR EACH ROW]
BEGIN
END;
</code>
</pre>

### 트리거 문법 구성
- [OR REPLACE] ; 기존 트리거 존재 시에 현재 컴파일하는 내용으로 덮어씀(해당 명령어가 없다면 같은 이름의 트리거 때문에 에러 발생)
- 순서[BEFORE|| AFTER] : - DML과 트리거가 실행되는 순서의 전후 관계를 BEFORE, AFTER 키워드를 이용하여 결정
- BEFORE : 테이블 명에 대한 명령이 수행되기 전에 트리거가 실행되도록 지정함
- AFTER : 테이벌 명에 대한 명령이 성공적으로 실행된 후에 트리거가 작동됨
- 유형 : DML에 해당되는 INSERT, UPDATE, DELETE 중 트리거를 수행할 명령어 유형, 각 명령어는 중복으로 선택이 가능함(INSERT OR DELETE)
- FOR EACH ROW  : 매번 변경되는 데이터 행의 수만큼 실행을 위한 명령어
- BEGIN : 트리거의 시작을 알려주는 키워드
- END  : 트리거의 끝을 알려준느 키워드
- 행 트리거 안에서  OLD  및 NEW 접두어를 붙여 데이터 변경 전후의 열의 값을 참조함
- INSERT : OLD 는 NULL, NEW는 삽입된 값
- UPDATE : OLD 는 갱신 전의 값, NEW는 갱신 후의 값
- DELETE : OLD 는 삭제 전의 값, NEW는 NULL

### 트리거 작성 시 유의 사항
- TCL 사용 불가 : 트리거 내에는 COMMIT, ROLLBACK 등의 트랜잭션 제어어(TCL) 사용시 컴파일 에러 발생
- 트리거 실행 중 오류가 발생하게 되면 트리거 실행의 원인을 제공한 데이터 작업에 영향을 미침
- 특정 테이블에 데이터를 추가한 후 발생하는 트리거에서 오류가 발생할 경우에 트리거 이후의 작업이 진행되지 않거나 추가되지 않음.


